---
title: Stable Online Computation Offloading via Lyapunov-guided Deep Reinforcement Learing
date: 2022-4-26
tags:
- MEC
- computation offload
- DRL
- math
categories:
- Paper
---
# 通过lyapunov DRL的稳定的在线卸载算法

## _Abstract_

在动态边缘环境中投机计算卸载是一个提升MEC网络计算能力的有效方法。

<font size=5>**背景**：<font>
本文中我们考虑时变无线信道和按顺序时间帧到达的随机用户任务数据条件下的多用户MEC网络。

<font size=5>**背景**：<font>我们打算设计一个在长期数据序列稳定并且平均功率受限的条件下的在线计算卸载算法以最大化网络数据处理能力。在线算法是实际的，因为每个时间帧的决定都是在未来信道条件和到达数据不知道的情况下做出的。

<font size=5>**问题**：<font>
我们将问题建模为一个多阶随机混合整数非线性规划问题，在连续帧中共同规划是否卸载，以及资源分配。

<font size=5>**方法**：<font>
为了处理这个耦合多个时隙的问题，我们提出了一个新的结构叫做LyDROO，它结合了lyapunov优化和DRL。特别是，LyDROO第一用应用lyapunov优化去解耦多阶随机MINLP（混合整数非线性规划）为更小的确定的每帧的MINLP子问题。然后，用结合了基于模型的优化和不基于模型的DRL来解决每一帧的MINLP问题，这个计算量非常低。

<font size=5>**结果**：</font>仿真结果显示LyDROO在满足长期限制的情况下实现了最佳的性能。除此之外，延时十分低并且很适合实时的深衰落信道。

## _Introduction_

边缘计算系统让无线设备可以将计算任务放到云端来减轻计算压力。与全部卸载相比，根据无线信道的衰落情况来选择本地执行还是送到云端。通常来说，解决一个是否卸载，以及任务卸载的时间和本地执行的CPU频率需要解一个多阶随机MINLP问题。为了解这种极高复杂度的问题，有很多次优的低复杂度的解决方法，比如：基于启发式的本地搜索，分方向搜索，二元变量的凸松弛等等。然而，上述方法不仅仅有性能的损失，而且需要大量的迭代。在高动态的环境中这些算法不适用。

最近数据驱动的深度学习方法可能解决这个问题。概括来说，DRL框架基于无模型的方法，用DNN网络直接学习从状态state（比如，时变系统的参数）到行动action（比如是否卸载和资源分配）的最佳映射，来最大化奖励reward（比如，数据处理速率）。使用的例子包括深度Q学习网络（DQN），双DQN，评价器DRL。特别是，之前我们的工作提出了一个混合结构，叫做DROO（基于深度学习的在线卸载），结合了传统的基于模型的优化，和不基于模型的DRL放大。这两者的结合使得对每个奖励的估计更加准确，让它鲁棒性更强，也更快的收敛训练过程。

除了优化计算性能，保证系统的稳定性也相同重要。（比如数据队列的稳定，平均功率损耗）然而，大多数现存的算法没有设置长期性能限制。相反，他们依赖探索式方法，通过引入相关处罚来阻碍不好的action，比如丢包或者能量消耗。一个很出名的用于在线最优化且有稳定限制的结构是lypunov优化。它可以解耦合多阶随机优化到一个序列的每一级的决定性子问题，同时提供长期的系统稳定性。最近有一些工作应用了lyapunov优化来设计MEC网络的计算卸载策略。然而，这还需要解决每个阶段的MINLP子问题。为了解决这个棘手的问题，有些方法减少了探索的复杂度，比如连续松弛，解耦合。然而，这些方法需要在性能和复杂度之间选择。

本文中，在多用户MEC网络中用一个服务器服务N个无线设备，计算任务随机到达无限设备。我们打算设计一个在线的计算卸载算法，也就是不知道未来的信道条件和将要到来的任务。目标是在长期稳定和功率受限的情况下，实现数据处理能力最大化。为了解决问题，我们提出了lyapunov指导的DRL，结合了lyapunov和DRL。与近视的最贪婪的算法相比，它能获得长期的稳定。

## _System model and problem formulation_

一个MEC网络中，一个服务器，N个无线设别，每帧间隔T。在第t个时隙内，我们用$A^t_i$来表示到达第i个设备的原始任务数据。我们假设$A^t_i$服从均值为$\lambda_i$的指数分布。我们标记第i个无线设备到云服务器中的信道条件为$h^t_i$。在块衰落的条件下，我们假设在一个时间帧内信道$h^t_i$保持一致，但是不同时隙不同。

在第t个时隙，我们假设标记的第i个无线设备处理$D^t_i$比特数据，并且在时隙结束时产生计算输出。在每个时隙内，我们假设计算卸载只有两种选择，要么全部自己算，要么全部交给云端。要卸载的无线设备共享W带宽来传输数据到云端使用TDMA。我们用二进制$x^t_i$来表示卸载决策。

当第i个无线设备选择本地执行数据（$x^t_i = 0$），我们用$f^t_i$表示本地的CPU计算频率，计算频率的上限为：$f^{max}_i$，在本地执行数据消耗的能量表达为：

$$D^t_{i,L} = f^t_iT/\phi,E^t_{i,L} = \kappa(f^t_i)^3T, \forall x^t_i = 0$$

其中$\phi$表示一个比特需要的计算周期，$\kappa$表示表示计算效率的参数。

否则，当数据被送到云端（$x^t_i = 0$），我们用$P^t_i$表示传输功率，有一个最大的功率限制$P^{max}_i$。用$\tau_i^tT$表示分配给第i个无线设备无线卸载的时间。其中$\tau_i^t \in [0,1]$并且$\sum^N_{i = 1}\tau_i^t \le 1$。计算卸载花费的能量是$E^t_{i,O} = P^t_i\tau^t_iT$，所以$P^t_i = E^t_{i,O}/\tau^t_iT$。我们忽略云计算和下行的时间，所以卸载的计算速率为：

$$D^t_{i,O} = \frac{W_{\tau^t_i}T}{v_u}log_2(1+\frac{E^t_{i,O}h^t_i}{\tau^t_iTN_0},\forall x^t_i = 1)$$

其中$v_u \ge 1$表示由于通信造成的损耗比例，$N_0$表示噪声功率。

定义$D^t_i \triangleq (1-x^t_i)D^t_{i,L}+x^t_iD^t_{i,O}$并且$E^t_i \triangleq (1-x^t_i)E^t_{i,L}+x^t_iE^t_{i,O}$来表示在t时隙计算的数据和能量。我们定义第t时隙的计算速率$r^t_i$以及能量$e^t_i$：

$$r^t_i = \frac{D^t_i}{T} = \frac{(1-x^t_i)f^t_i}{\phi}+x^t_i\frac{W_{\tau_i^t}}{v_u}log_2(1+\frac{e^t_{i,O}h^t_i}{\tau^t_iN_0})$$
$$e^t_i = \frac{E^t_i}{T} = (1-x^t_i)\kappa(f^t_i)^3+x^t_ie^t_{i,O}$$

其中$e^t_{i,O} \triangleq E^t_{i,O}/T$，为了简单说明，我们假设T = 1，这在我们推导时不失一般性。

用$Q_i(t)$表示第i个无线设备在第t个时隙的队列长度：

$$Q_{i}(t+1) = max\{Q_i(t)-\widetilde D_i^t + A^t_i,0\}$$

其中$\widetilde D^t_i = min(Q_i(t),D^t_i)$并且$Q_i(1) = 0$意思是队列的长度等于上一时隙的队列长度减去上一时隙执行的长度加上上一时隙到达的长度，并且不小于0。其中执行的不能超过第i时刻的队列长度。如果$lim_{K \to \infin} \frac{1}{K}\sum^K_{t = 1}E[Q_i(t)] < \infin$，我们认为队列是稳定的，即使在随机信道衰落以及随机任务到达时。通过利特尔法则，我们可以将这个说法转变为每个任务比特的延时是有限的。

本文中，我们打算设计一个在线算法在队列稳定和平均功耗限制下，最大化所有无线设备的长期平均的加权计算速率。$x^t = [x^t_i,...,x^t_N]$$\bold{x} = \{x^t\}^K_{t=1}$其他如此，我们将问题建模为：

$$\max\limits_{\bold{x},\bold{\tau},\bold{f},\bold{e_O}} \lim\limits_{K \to \infin} \frac{1}{K}\sum^K_{t = 1}\sum^N_{i = 1}c_ir^t_i$$
其中$c_i$表示第i个设备的加权系数。
$$s.t. \sum^N_{i = 1}\tau^t_i \le 1$$
$$\frac{D^t_i}{T} = \frac{(1-x^t_i)f^t_i}{\phi}+x^t_i\frac{W_{\tau_i^t}}{v_u}log_2(1+\frac{e^t_{i,O}h^t_i}{\tau^t_iN_0}) \le Q_i(t)$$
$$lim_{K \to \infin} \frac{1}{K}\sum^K_{t = 1}E[\frac{E^t_i}{T} = (1-x^t_i)\kappa(f^t_i)^3+x^t_ie^t_{i,O}] < \infin$$
$$lim_{K \to \infin} \frac{1}{K}\sum^K_{t = 1}E[Q_i(t)] < \infin$$

下面将提出LyDROO结构来解决。

## _Lyapunov-based multi-stage decoupling_

这部分，我们应用lyapunov优化将问题解耦为每帧的确定性问题。为了解决平均功耗问题，我们引入N个虚拟的能量队列$\{Y_i(t)\}^N_{i = 1}$，$Y_i(1) = 0$并且用：

$$Y_i(t+1) = max(Y_i(t)+ve^t_i-v\gamma_i,0)$$

其中$e^t_i$是第t时刻，第i个无线设备的能量消耗，$v$是一个正系数。直觉上来说，如果虚拟的能量队列稳定，那么平均功率$e^t_i$不会超过$\gamma_i$，即原问题的限制被满足了。

我们定义$Z(t) = {Q(t),Y(t)}$来表示整个队列积压的工作。其中$Q(t) = {Q_i(t)}^N_{i = 1}$，$Y(t) = {Y_i(t)}^N_{i = 1}$，接着我们引入lyapunov方程L(Z(t))和lyapunov偏移$\Delta L(Z(t))$:

$$L(Z(t)) = 0.5(\sum^N_{i = 1}Q_i(t)^2+\sum^N_{i = 1}Y_i(t)^2)$$
$$\Delta L(Z(t)) = E(L(Z(t+1))-L(Z(t))|Z(t))$$